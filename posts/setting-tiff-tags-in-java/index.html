<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Setting Tiff tags in Java | Delcastanher's Memory Allocation</title><meta name=keywords content="Java"><meta name=description content="Create or modify any Tiff header tags when saving it in Java."><meta name=author content="Ricardo Delcastanher"><link rel=canonical href=https://delcastanher.github.io/posts/setting-tiff-tags-in-java/><link crossorigin=anonymous href=/assets/css/stylesheet.d7fb4cbf980fe688a21621b06a795933c4e6bb2d4070ec940667af1715d84af2.css integrity="sha256-1/tMv5gP5oiiFiGwanlZM8Tmuy1AcOyUBmevFxXYSvI=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://delcastanher.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://delcastanher.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://delcastanher.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://delcastanher.github.io/apple-touch-icon.png><link rel=mask-icon href=https://delcastanher.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Setting Tiff tags in Java"><meta property="og:description" content="Create or modify any Tiff header tags when saving it in Java."><meta property="og:type" content="article"><meta property="og:url" content="https://delcastanher.github.io/posts/setting-tiff-tags-in-java/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-07-05T10:02:33-03:00"><meta property="article:modified_time" content="2022-07-05T10:02:33-03:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Setting Tiff tags in Java"><meta name=twitter:description content="Create or modify any Tiff header tags when saving it in Java."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://delcastanher.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Setting Tiff tags in Java","item":"https://delcastanher.github.io/posts/setting-tiff-tags-in-java/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Setting Tiff tags in Java","name":"Setting Tiff tags in Java","description":"Create or modify any Tiff header tags when saving it in Java.","keywords":["Java"],"articleBody":"Setting Tiff tags when saving a Tiff file in Java is tricky. PDFBox does this, putting some basic tags on the exported file 1, but it does not give you the option to change or add tags.\nTo achieve the same results as the following codes, you need some Java objects:\nAn ImageWriter writer; An ImageWriteParam param; A BufferedImage bim. With these in your hands, create an IIOMetadata object.\n1 2 3 4 5 6 7 IIOMetadata metadata = writer.getDefaultImageMetadata(new ImageTypeSpecifier(bim), param); String metaDataFormat = metadata.getNativeMetadataFormatName(); IIOMetadataNode root = new IIOMetadataNode(metaDataFormat); IIOMetadataNode ifd = new IIOMetadataNode(\"TIFFIFD\"); root.appendChild(ifd); ifd.appendChild(createAsciiField(305, \"Software\", \"MyApp\")); metadata.mergeTree(metaDataFormat, root); The sixth line is where one specific tag is being created. It uses createAsciiField(), one of the methods from PDFBox’s TIFFUtil class.\nprivate static IIOMetadataNode createShortField(int tiffTagNumber, String name, int val) { IIOMetadataNode field = new IIOMetadataNode(\"TIFFField\"); field.setAttribute(\"number\", Integer.toString(tiffTagNumber)); field.setAttribute(\"name\", name); IIOMetadataNode arrayNode = new IIOMetadataNode(\"TIFFShorts\"); field.appendChild(arrayNode); IIOMetadataNode valueNode = new IIOMetadataNode(\"TIFFShort\"); arrayNode.appendChild(valueNode); valueNode.setAttribute(\"value\", Integer.toString(val)); return field; } private static IIOMetadataNode createAsciiField(int number, String name, String val) { IIOMetadataNode field = new IIOMetadataNode(\"TIFFField\"); field.setAttribute(\"number\", Integer.toString(number)); field.setAttribute(\"name\", name); IIOMetadataNode arrayNode = new IIOMetadataNode(\"TIFFAsciis\"); field.appendChild(arrayNode); IIOMetadataNode valueNode = new IIOMetadataNode(\"TIFFAscii\"); arrayNode.appendChild(valueNode); valueNode.setAttribute(\"value\", val); return field; } private static IIOMetadataNode createLongField(int number, String name, long val) { IIOMetadataNode field = new IIOMetadataNode(\"TIFFField\"); field.setAttribute(\"number\", Integer.toString(number)); field.setAttribute(\"name\", name); IIOMetadataNode arrayNode = new IIOMetadataNode(\"TIFFLongs\"); field.appendChild(arrayNode); IIOMetadataNode valueNode = new IIOMetadataNode(\"TIFFLong\"); arrayNode.appendChild(valueNode); valueNode.setAttribute(\"value\", Long.toString(val)); return field; } private static IIOMetadataNode createRationalField(int number, String name, int numerator, int denominator) { IIOMetadataNode field = new IIOMetadataNode(\"TIFFField\"); field.setAttribute(\"number\", Integer.toString(number)); field.setAttribute(\"name\", name); IIOMetadataNode arrayNode = new IIOMetadataNode(\"TIFFRationals\"); field.appendChild(arrayNode); IIOMetadataNode valueNode = new IIOMetadataNode(\"TIFFRational\"); arrayNode.appendChild(valueNode); valueNode.setAttribute(\"value\", numerator + \"/\" + denominator); return field; } There is one method for each Tiff tag type.\nLet’s take the DocumentName Tiff tag as an example. Suppose you want to add this tag to your Tiff file. As you can see on https://www.awaresystems.be/imaging/tiff/tifftags/documentname.html it has:\nType: ASCII So you need to use the createAsciiField() method Code: 269 This is the first createAsciiField() parameter Name: DocumentName This is the second createAsciiField() parameter The third createAsciiField() parameter is the value you want inside the tag. In this case, the value inside the DocumentName tag. ifd.appendChild(createAsciiField(269, \"DocumentName\", \"My Document Name\")); You can use the logic above for all other tags and repeat the sixth line for each tag chosen before the metadata.mergeTree(metaDataFormat, root); call.\nOnce the IIOMetadata metadata object is created, you can pass it as the third parameter of the IIOImage constructor, that in turn, is the first parameter of javax.imageio.ImageWriter.write() and javax.imageio.ImageWriter.writeToSequence().\nIn our Convert a multi-page PDF into a multi-page Tiff example, the writeToSequence() call now should be:\nwriter.writeToSequence(new IIOImage(bim, null, metadata), null); Other options https://docs.oracle.com/en/java/javase/11/docs/api/java.desktop/javax/imageio/metadata/doc-files/tiff_metadata.html https://github.com/ngageoint/tiff-java https://github.com/apache/pdfbox/blob/trunk/tools/src/main/java/org/apache/pdfbox/tools/imageio/TIFFUtil.java ↩︎\n","wordCount":"444","inLanguage":"en","datePublished":"2022-07-05T10:02:33-03:00","dateModified":"2022-07-05T10:02:33-03:00","author":{"@type":"Person","name":"Ricardo Delcastanher"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://delcastanher.github.io/posts/setting-tiff-tags-in-java/"},"publisher":{"@type":"Organization","name":"Delcastanher's Memory Allocation","logo":{"@type":"ImageObject","url":"https://delcastanher.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://delcastanher.github.io/ accesskey=h title="Delcastanher's Memory Allocation (Alt + H)">Delcastanher's Memory Allocation</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Setting Tiff tags in Java</h1><div class=post-meta><span title='2022-07-05 10:02:33 -0300 -0300'>July 5, 2022</span>&nbsp;·&nbsp;Ricardo Delcastanher</div></header><div class=post-content><p>Setting Tiff tags when saving a Tiff file in Java is tricky. PDFBox does this, putting some basic tags on the exported file <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>, but it does not give you the option to change or add tags.</p><p>To achieve the same results as the following codes, you need some Java objects:</p><ul><li>An <a href=/posts/convert-pdf-to-tiff-in-java-with-apache-pdfbox/#convert-a-multi-page-pdf-into-a-multi-page-tiff><code>ImageWriter writer</code></a>;</li><li>An <a href=/posts/tiff-compression-in-java/><code>ImageWriteParam param</code></a>;</li><li>A <a href=/posts/convert-pdf-to-tiff-in-java-with-apache-pdfbox/#convert-a-multi-page-pdf-into-a-multi-page-tiff><code>BufferedImage bim</code></a>.</li></ul><p>With these in your hands, create an <code>IIOMetadata</code> object.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Java data-lang=Java><span style=display:flex><span>IIOMetadata metadata <span style=color:#f92672>=</span> writer<span style=color:#f92672>.</span><span style=color:#a6e22e>getDefaultImageMetadata</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> ImageTypeSpecifier<span style=color:#f92672>(</span>bim<span style=color:#f92672>),</span> param<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>String metaDataFormat <span style=color:#f92672>=</span> metadata<span style=color:#f92672>.</span><span style=color:#a6e22e>getNativeMetadataFormatName</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>IIOMetadataNode root <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> IIOMetadataNode<span style=color:#f92672>(</span>metaDataFormat<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>IIOMetadataNode ifd <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> IIOMetadataNode<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;TIFFIFD&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>root<span style=color:#f92672>.</span><span style=color:#a6e22e>appendChild</span><span style=color:#f92672>(</span>ifd<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>ifd<span style=color:#f92672>.</span><span style=color:#a6e22e>appendChild</span><span style=color:#f92672>(</span>createAsciiField<span style=color:#f92672>(</span><span style=color:#ae81ff>305</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;Software&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;MyApp&#34;</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>metadata<span style=color:#f92672>.</span><span style=color:#a6e22e>mergeTree</span><span style=color:#f92672>(</span>metaDataFormat<span style=color:#f92672>,</span> root<span style=color:#f92672>);</span>
</span></span></code></pre></td></tr></table></div></div><p>The sixth line is where one specific tag is being created. It uses <code>createAsciiField()</code>, one of the methods from <a href=https://github.com/apache/pdfbox/blob/trunk/tools/src/main/java/org/apache/pdfbox/tools/imageio/TIFFUtil.java>PDFBox&rsquo;s <code>TIFFUtil</code> class</a>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Java data-lang=Java><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> IIOMetadataNode <span style=color:#a6e22e>createShortField</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> tiffTagNumber<span style=color:#f92672>,</span> String name<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> val<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    IIOMetadataNode field <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> IIOMetadataNode<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;TIFFField&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    field<span style=color:#f92672>.</span><span style=color:#a6e22e>setAttribute</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;number&#34;</span><span style=color:#f92672>,</span> Integer<span style=color:#f92672>.</span><span style=color:#a6e22e>toString</span><span style=color:#f92672>(</span>tiffTagNumber<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>    field<span style=color:#f92672>.</span><span style=color:#a6e22e>setAttribute</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;name&#34;</span><span style=color:#f92672>,</span> name<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    IIOMetadataNode arrayNode <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> IIOMetadataNode<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;TIFFShorts&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    field<span style=color:#f92672>.</span><span style=color:#a6e22e>appendChild</span><span style=color:#f92672>(</span>arrayNode<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    IIOMetadataNode valueNode <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> IIOMetadataNode<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;TIFFShort&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    arrayNode<span style=color:#f92672>.</span><span style=color:#a6e22e>appendChild</span><span style=color:#f92672>(</span>valueNode<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    valueNode<span style=color:#f92672>.</span><span style=color:#a6e22e>setAttribute</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;value&#34;</span><span style=color:#f92672>,</span> Integer<span style=color:#f92672>.</span><span style=color:#a6e22e>toString</span><span style=color:#f92672>(</span>val<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> field<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> IIOMetadataNode <span style=color:#a6e22e>createAsciiField</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> number<span style=color:#f92672>,</span> String name<span style=color:#f92672>,</span> String val<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    IIOMetadataNode field <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> IIOMetadataNode<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;TIFFField&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    field<span style=color:#f92672>.</span><span style=color:#a6e22e>setAttribute</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;number&#34;</span><span style=color:#f92672>,</span> Integer<span style=color:#f92672>.</span><span style=color:#a6e22e>toString</span><span style=color:#f92672>(</span>number<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>    field<span style=color:#f92672>.</span><span style=color:#a6e22e>setAttribute</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;name&#34;</span><span style=color:#f92672>,</span> name<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    IIOMetadataNode arrayNode <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> IIOMetadataNode<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;TIFFAsciis&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    field<span style=color:#f92672>.</span><span style=color:#a6e22e>appendChild</span><span style=color:#f92672>(</span>arrayNode<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    IIOMetadataNode valueNode <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> IIOMetadataNode<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;TIFFAscii&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    arrayNode<span style=color:#f92672>.</span><span style=color:#a6e22e>appendChild</span><span style=color:#f92672>(</span>valueNode<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    valueNode<span style=color:#f92672>.</span><span style=color:#a6e22e>setAttribute</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;value&#34;</span><span style=color:#f92672>,</span> val<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> field<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> IIOMetadataNode <span style=color:#a6e22e>createLongField</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> number<span style=color:#f92672>,</span> String name<span style=color:#f92672>,</span> <span style=color:#66d9ef>long</span> val<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    IIOMetadataNode field <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> IIOMetadataNode<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;TIFFField&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    field<span style=color:#f92672>.</span><span style=color:#a6e22e>setAttribute</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;number&#34;</span><span style=color:#f92672>,</span> Integer<span style=color:#f92672>.</span><span style=color:#a6e22e>toString</span><span style=color:#f92672>(</span>number<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>    field<span style=color:#f92672>.</span><span style=color:#a6e22e>setAttribute</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;name&#34;</span><span style=color:#f92672>,</span> name<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    IIOMetadataNode arrayNode <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> IIOMetadataNode<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;TIFFLongs&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    field<span style=color:#f92672>.</span><span style=color:#a6e22e>appendChild</span><span style=color:#f92672>(</span>arrayNode<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    IIOMetadataNode valueNode <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> IIOMetadataNode<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;TIFFLong&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    arrayNode<span style=color:#f92672>.</span><span style=color:#a6e22e>appendChild</span><span style=color:#f92672>(</span>valueNode<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    valueNode<span style=color:#f92672>.</span><span style=color:#a6e22e>setAttribute</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;value&#34;</span><span style=color:#f92672>,</span> Long<span style=color:#f92672>.</span><span style=color:#a6e22e>toString</span><span style=color:#f92672>(</span>val<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> field<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> IIOMetadataNode <span style=color:#a6e22e>createRationalField</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> number<span style=color:#f92672>,</span> String name<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> numerator<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> denominator<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    IIOMetadataNode field <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> IIOMetadataNode<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;TIFFField&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    field<span style=color:#f92672>.</span><span style=color:#a6e22e>setAttribute</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;number&#34;</span><span style=color:#f92672>,</span> Integer<span style=color:#f92672>.</span><span style=color:#a6e22e>toString</span><span style=color:#f92672>(</span>number<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>    field<span style=color:#f92672>.</span><span style=color:#a6e22e>setAttribute</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;name&#34;</span><span style=color:#f92672>,</span> name<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    IIOMetadataNode arrayNode <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> IIOMetadataNode<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;TIFFRationals&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    field<span style=color:#f92672>.</span><span style=color:#a6e22e>appendChild</span><span style=color:#f92672>(</span>arrayNode<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    IIOMetadataNode valueNode <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> IIOMetadataNode<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;TIFFRational&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    arrayNode<span style=color:#f92672>.</span><span style=color:#a6e22e>appendChild</span><span style=color:#f92672>(</span>valueNode<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    valueNode<span style=color:#f92672>.</span><span style=color:#a6e22e>setAttribute</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;value&#34;</span><span style=color:#f92672>,</span> numerator <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;/&#34;</span> <span style=color:#f92672>+</span> denominator<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> field<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>There is one method for <a href=https://www.loc.gov/preservation/digital/formats/content/tiff_tags.shtml>each Tiff tag type</a>.</p><p>Let&rsquo;s take the <strong>DocumentName</strong> Tiff tag as an example. Suppose you want to add this tag to your Tiff file. As you can see on <a href=https://www.awaresystems.be/imaging/tiff/tifftags/documentname.html>https://www.awaresystems.be/imaging/tiff/tifftags/documentname.html</a> it has:</p><ul><li>Type: <strong>ASCII</strong><ul><li>So you need to use the <code>createAsciiField()</code> method</li></ul></li><li>Code: <strong>269</strong><ul><li>This is the first <code>createAsciiField()</code> parameter</li></ul></li><li>Name: <strong>DocumentName</strong><ul><li>This is the second <code>createAsciiField()</code> parameter</li></ul></li><li>The third <code>createAsciiField()</code> parameter is the value you want inside the tag. In this case, the value inside the <strong>DocumentName</strong> tag.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Java data-lang=Java><span style=display:flex><span>ifd<span style=color:#f92672>.</span><span style=color:#a6e22e>appendChild</span><span style=color:#f92672>(</span>createAsciiField<span style=color:#f92672>(</span><span style=color:#ae81ff>269</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;DocumentName&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;My Document Name&#34;</span><span style=color:#f92672>));</span>
</span></span></code></pre></div><p>You can use the logic above for all other tags and repeat the sixth line for each tag chosen before the <code>metadata.mergeTree(metaDataFormat, root);</code> call.</p><p>Once the <code>IIOMetadata metadata</code> object is created, you can pass it as the third parameter of the <a href=https://docs.oracle.com/en/java/javase/11/docs/api/java.desktop/javax/imageio/IIOImage.html><code>IIOImage</code></a> constructor, that in turn, is the first parameter of <a href=https://docs.oracle.com/en/java/javase/11/docs/api/java.desktop/javax/imageio/ImageWriter.html#write(javax.imageio.metadata.IIOMetadata,javax.imageio.IIOImage,javax.imageio.ImageWriteParam)><code>javax.imageio.ImageWriter.write()</code></a> and <a href=https://docs.oracle.com/en/java/javase/11/docs/api/java.desktop/javax/imageio/ImageWriter.html#writeToSequence(javax.imageio.IIOImage,javax.imageio.ImageWriteParam)><code>javax.imageio.ImageWriter.writeToSequence()</code></a>.</p><p>In our <a href=/posts/convert-pdf-to-tiff-in-java-with-apache-pdfbox/>Convert a multi-page PDF into a multi-page Tiff</a> example, the <code>writeToSequence()</code> call now should be:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Java data-lang=Java><span style=display:flex><span>writer<span style=color:#f92672>.</span><span style=color:#a6e22e>writeToSequence</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> IIOImage<span style=color:#f92672>(</span>bim<span style=color:#f92672>,</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>,</span> metadata<span style=color:#f92672>),</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>);</span>
</span></span></code></pre></div><h3 id=other-options>Other options<a hidden class=anchor aria-hidden=true href=#other-options>#</a></h3><ul><li><a href=https://docs.oracle.com/en/java/javase/11/docs/api/java.desktop/javax/imageio/metadata/doc-files/tiff_metadata.html>https://docs.oracle.com/en/java/javase/11/docs/api/java.desktop/javax/imageio/metadata/doc-files/tiff_metadata.html</a></li><li><a href=https://github.com/ngageoint/tiff-java>https://github.com/ngageoint/tiff-java</a></li></ul><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=https://github.com/apache/pdfbox/blob/trunk/tools/src/main/java/org/apache/pdfbox/tools/imageio/TIFFUtil.java>https://github.com/apache/pdfbox/blob/trunk/tools/src/main/java/org/apache/pdfbox/tools/imageio/TIFFUtil.java</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://delcastanher.github.io/tags/java/>Java</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://delcastanher.github.io/>Delcastanher's Memory Allocation</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>